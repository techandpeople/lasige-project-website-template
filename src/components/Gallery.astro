---
import fs from 'node:fs';
import path from 'node:path';
import { type UIStrings } from '../i18n';
import { withBase } from '../utils/url';
import GalleryGrid from './GalleryGrid.astro';
import GalleryCarousel from './GalleryCarousel.astro';

interface Props {
	ui: UIStrings;
	siteConfig: Record<string, any>;
}

const { ui, siteConfig } = Astro.props;
const title = siteConfig.gallery?.title || 'Gallery';
const style = siteConfig.gallery?.style || 'grid';

const galleryDir = path.resolve('public/images/gallery');
const extensions = new Set(['.jpg', '.jpeg', '.png', '.webp', '.gif', '.avif', '.svg']);

const imageList = fs.existsSync(galleryDir)
	? fs.readdirSync(galleryDir)
		.filter((f: string) => extensions.has(path.extname(f).toLowerCase()))
		.sort()
		.map((f: string) => ({
			src: withBase(`/images/gallery/${f}`),
			alt: f.replace(/\.[^.]+$/, '').replace(/[-_]/g, ' '),
		}))
	: [];
---
{imageList.length > 0 && (
	style === 'carousel'
		? <GalleryCarousel imageList={imageList} title={title} ui={ui} />
		: <GalleryGrid imageList={imageList} title={title} ui={ui} />
)}
