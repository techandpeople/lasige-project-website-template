<script>
	// Smooth scroll with offset for fixed navbar
	document.querySelectorAll('a[href^="#"]').forEach(anchor => {
		anchor.addEventListener('click', (e) => {
			e.preventDefault();
			const href = (anchor as HTMLAnchorElement).getAttribute('href');
			if (!href) return;
			const target = document.querySelector(href);
			if (target) {
				const navbarHeight = document.getElementById('navbar')?.offsetHeight || 64;
				const top = target.getBoundingClientRect().top + window.scrollY - navbarHeight;
				window.scrollTo({ top, behavior: 'smooth' });
				history.replaceState(null, '', href);
			}
			// Close mobile menu if open
			const menu = document.getElementById('mobile-menu');
			const toggle = document.getElementById('menu-toggle');
			menu?.classList.remove('open');
			toggle?.classList.remove('open');
		});
	});

	// Intersection Observer for active nav link highlighting
	const sections = document.querySelectorAll('section[id]');
	const navLinks = document.querySelectorAll('.nav-link');

	const observer = new IntersectionObserver((entries) => {
		entries.forEach(entry => {
			if (entry.isIntersecting) {
				navLinks.forEach(link => {
					const isActive = link.getAttribute('href') === `#${entry.target.id}`;
					link.classList.toggle('text-primary', isActive);
					link.classList.toggle('font-bold', isActive);
				});
			}
		});
	}, { rootMargin: '-20% 0px -80% 0px' });

	sections.forEach(section => observer.observe(section));
</script>
